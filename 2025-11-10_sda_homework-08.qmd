---
title: "Homework-#: Title"
author: "E. Duke Chase"
date: today
---
```{r}
#| label: setup
#| include: false

library(here)
source(here::here("R", "setup.R"))

# Set key directory paths
data_dir <- here::here("data")
output_dir <- here::here("output")
```

The `cow.rda` file contains a data frame with 200 spatial observations observed throughout the state of Colorado.  The data frame includes `easting` and `northing` coordinates (UTM, scaled by 1000 meters) and Tungsten measurements (`W`) at each site (mg/kg). Read in the data as a data frame from the file.  

# Preliminaries

Load the **gstat** and **geoR** packages. Load the `cow.rda` file.

# Problem 0

Create `cow_sf`, an `sf` version of `cow` that uses `easting` and `northing` for `coords`. 

Create `geocow`, a `geodata` object from the **geoR** package.

Also run the following code.

```{r}
#| p_0-setup

# Load data
load(here("data", "cow.rda"))

# Create `sf` and `geodata` versions of the data
cow_sf <- sf::st_as_sf(cow, coords = c("easting", "northing"))
geocow <- as.geodata(cbind(cow$easting, cow$northing, cow$W))

set.seed(1)
poly_sf <- sf::st_polygon(x = list(cbind(
  c(152, 152, 753, 753, 152),
  c(4100, 4544, 4544, 4100, 4100))))

grid_sf <- sf::st_sample(poly_sf, size = 100,
                         type = "regular")
```

**Solution**

# Problem 1 (Using geoR)

Use REML estimation with a constant mean function to fit the following covariance models to the data:

a. An isotropic spherical model.
b. A geometric anisotropic spherical model.
c. An isotropic exponential model.
d. A geometric anisotropic exponential model.

Make a table that provides the following information about each model: model, partial sill ($c$), range parameter ($a$ or $a_{min}$), nugget ($c_0$), direction of the major axis in degrees, (if appropriate), anisotropy ratio $a_{max}/a_{min}$, AIC of the fit.

Note: starting values make a HUGE difference for the anisotropic models, so you probably want to experiment a bit.

Which model is the best choice?

**Solution**

# Problem 2

Create two `gstat` objects with a constant mean and the directional semivariogram model that matches the REML fit provided below. For the first, assume the nugget is microscale error (standard kriging) while the second is measurement error (filtered kriging).

Reminder: **gstat** and **geoR** parameterize the angle and ratio of the $a_{minor}$ and $a_{major}$ differently, so carefully read the documentation. 

```
Summary of the parameter estimation
-----------------------------------
Estimation method: restricted maximum likelihood 

Parameters of the mean component (trend):
  beta 
0.9343 

Parameters of the spatial component:
   correlation function: exponential
      (estimated) variance parameter sigmasq (partial sill) =  1.158
      (estimated) cor. fct. parameter phi (range parameter)  =  3.276
   anisotropy parameters:
      (fixed) anisotropy angle = 0.7854  ( 45.0001052295748 degrees )
      (fixed) anisotropy ratio = 2

Parameter of the error component:
      (estimated) nugget =  0.102

Transformation parameter:
      (fixed) Box-Cox parameter = 1 (no transformation)

Practical Range with cor=0.05 for asymptotic range: 9.812505

Maximised Likelihood:
   log.L n.params      AIC      BIC 
"-296.1"      "4"  "600.1"  "613.3" 

non spatial model:
   log.L n.params      AIC      BIC 
"-297.6"      "2"  "599.1"  "605.7" 

Call:
likfit(geodata = geocow, ini.cov.pars = c(0.5, 10), fix.nugget = FALSE, 
    nugget = 0.1, fix.psiA = TRUE, psiA = pi/4, fix.psiR = TRUE, 
    psiR = 2, cov.model = "exponential", lik.method = "REML", 
    messages = FALSE)
```

**Solution**

# Problem 3

Perform standard kriging at the locations contained in `grid_sf` using the `gstat` object created in the previous problem.

Use the `summary` function to summarize your results.

**Solution**

# Problem 4

Perform filtered kriging at the locations contained in `grid_sf` using the `gstat` object created in Problem 2.

Use the `summary` function to summarize your results.

**Solution**

# Problem 5

Are the predictions for standard and filtered kriging identical for the predictions above? Why?

**Solution**

# Problem 6

Create side-by-side plots of the kriging variances from Problems 3 and 4 with a common color scale. Which variances are higher?

**Solution**

# Problem 7

Perform standard kriging at the locations contained in `cow_sf` using the `gstat` object created in Problem 2.

Use the `summary` function to summarize your results.

**Solution**

# Problem 8

Perform filtered kriging at the locations contained in `cow_sf` using the `gstat` object created in Problem 2.

Use the `summary` function to summarize your results.

**Solution**

# Problem 9

Are the standard and unfiltered kriging predictions the same at the observed data locations? Why?

**Solution**

# Problem 10

What do you notice about the kriging variances for the filtered and unfilted kriging predictions at observed data locations?

**Solution**